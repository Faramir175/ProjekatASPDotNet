@model IEnumerable<MojAtar.Core.Domain.CenaResursa>

@{
    ViewData["Title"] = "Istorija cena resursa";
}

<div class="container mt-5">
    <div class="container-glass p-4">
        <h2 class="text-center mb-4">📦 Istorija cena resursa</h2>

        <div class="table-responsive">
            <table class="table table-bordered table-striped align-middle" id="resursiTabela">
                <thead class="table-light">
                    <tr>
                        <th onclick="sortTable(0, 'resursiTabela')" style="cursor:pointer;">
                            Resurs <i class="bi bi-arrow-down-up"></i>
                        </th>
                        <th onclick="sortTable(1, 'resursiTabela')" style="cursor:pointer;">
                            Cena po jedinici (RSD) <i class="bi bi-arrow-down-up"></i>
                        </th>
                        <th onclick="sortTable(2, 'resursiTabela')" style="cursor:pointer;">
                            Datum važenja <i class="bi bi-arrow-down-up"></i>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var c in Model)
                    {
                        <tr>
                            <td>@c.Resurs.Naziv</td>
                            <td>@c.CenaPojedinici.ToString("N2")</td>
                            <td>@c.DatumVaznosti.ToShortDateString()</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Klijent-side sortiranje
        function sortTable(columnIndex, tableId) {
            const table = document.getElementById(tableId);
            const rows = Array.from(table.rows).slice(1); // bez headera
            const isNumeric = columnIndex === 1; // Cena je numerička
            const isDate = columnIndex === 2;
            const dir = table.dataset.sortDir === "asc" ? "desc" : "asc";
            table.dataset.sortDir = dir;

            rows.sort((a, b) => {
                let A = a.cells[columnIndex].innerText.trim();
                let B = b.cells[columnIndex].innerText.trim();

                if (isNumeric) {
                    A = parseFloat(A.replace(",", ""));
                    B = parseFloat(B.replace(",", ""));
                } else if (isDate) {
                    A = new Date(A.split(".").reverse().join("-"));
                    B = new Date(B.split(".").reverse().join("-"));
                } else {
                    A = A.toLowerCase();
                    B = B.toLowerCase();
                }

                if (A < B) return dir === "asc" ? -1 : 1;
                if (A > B) return dir === "asc" ? 1 : -1;
                return 0;
            });

            rows.forEach(row => table.tBodies[0].appendChild(row));
        }
    </script>
}
